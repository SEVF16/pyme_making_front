<!-- custom-data-table.component.html - Simplificado -->
<div class="custom-datatable-wrapper">
  <!-- Data Table -->
  <p-table 
    #dataTable
    [value]="data"
    [columns]="visibleColumns()"
    [paginator]="config.showPaginator !== false"
    [rows]="tableState().rows"
    [totalRecords]="tableState().totalRecords"
    [lazy]="config.lazy || false"
    [first]="tableState().first"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="{first} - {last}"
    [rowsPerPageOptions]="config.rowsPerPageOptions || [10, 25, 50, 100]"
    [responsive]="config.responsive !== false"
    [dataKey]="config.dataKey || 'id'"
    [rowTrackBy]="trackBy"
    [styleClass]="tableStyleClass()"
    (onLazyLoad)="onLazyLoad($event)"
    (onPage)="onPageChange($event)">

    <!-- Table Header -->
    <ng-template pTemplate="header">
      <tr>
        @for (col of visibleColumns(); track col.field) {
          <th 
            [ngStyle]="getColumnStyle(col)"
            [class]="getColumnClass(col)">
            <span>{{ col.header }}</span>
          </th>
        }
      </tr>
    </ng-template>

    <!-- Table Body -->
    <ng-template pTemplate="body" let-rowData let-rowIndex="rowIndex">
      <tr [class]="getRowClass(rowData, rowIndex)">
        @for (col of visibleColumns(); track col.field) {
          <td 
            [ngStyle]="getColumnStyle(col)"
            [class]="getColumnClass(col)">
            
            <!-- ✨ TEMPLATE: Acciones -->
            @if (col.actions) {
              <div class="d-flex gap-1 justify-content-center">
                @for (action of getVisibleActions(col.actions, rowData); track action.label) {
                  <p-button
                    [outlined]="true"
                    size="small"
                    [disabled]="isActionDisabled(action, rowData)"
                    [pTooltip]="action.tooltip || action.label"
                    (onClick)="executeAction(action, rowData, rowIndex)">
                    <lucide-angular [img]="getActionIcon(action.icon)" size="16" class="d-flex justify-content-center align-items-center"></lucide-angular>
                  </p-button>
                }
              </div>
            } 
            
            <!-- ✨ TEMPLATE: Nombre con Subtítulo (RUT) -->
            @else if (hasTemplate(col, 'nameWithSubtitle')) {
              <div class="name-with-subtitle">
                <div class="fw-semibold text-dark">
                  {{ getFieldValue(rowData, col) }}
                </div>
                <small class="text-muted d-block mt-1">
                  {{ getSubtitleValue(rowData, col) }}
                </small>
              </div>
            }
            
            <!-- ✨ TEMPLATE: Badge -->
            @else if (hasTemplate(col, 'badge')) {
              <span [class]="'badge bg-' + (col.customRender ? col.customRender(rowData) : 'secondary')">
                {{ getFieldValue(rowData, col) }}
              </span>
            }
            
            <!-- ✨ TEMPLATE: Custom Render -->
            @else if (col.customRender) {
              <span [innerHTML]="col.customRender(rowData)"></span>
            }
            
            <!-- ✨ TEMPLATE: Default (texto simple) -->
            @else {
              <span>{{ getFieldValue(rowData, col) }}</span>
            }
          </td>
        }
      </tr>
    </ng-template>

    <!-- Empty State -->
    <ng-template pTemplate="emptymessage">
      <tr>
        <td [attr.colspan]="visibleColumns().length" class="text-center py-4">
          <div class="empty-state">
            <h6 class="text-muted mb-2">{{ config.emptyMessage || 'No se encontraron datos' }}</h6>
            <p class="text-muted small mb-0">No hay registros para mostrar</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>